# SQS

- ### 긴 폴링

  - ReceiveMessage API 작업의 **대기 시간**이 크다
  - 응답을 보내기 전에 대기열에서 메시지를 사용할 수 있을 때까지 기다림
  - 큐의 수신 메시지 대기 시간을 늘린다

- 마이크로 서비스, 분산 시스템 및 서버리스 애플리케이션을 분리하고 확장할 수 있는 완전 관리형 메시지 대기열 서비스

# ELB

- 상태 확인 : ALB는 등록된 대상에 주기적으로 요청을 보내 상태를 테스트함
- 요청을 정상 인스턴스로만 보낸다

- 구성 가능한 연속 횟수 동안 상태 확인에 실패한 인스턴스는 **비정상**으로 간주

- 비정상 인스턴스는 다음 번 상태 확인을 **통과할 때까지 더 이상 인스턴스 요청** 보내지 않는다

- 고정 세션 : 로드 밸런서가 사용자의 요청을 동일한 대상으로 일관되게 라우팅 해야하는 시간을 결정
- 로드 밸런서와 연결된 보안 그룹이 새 포트의 트래픽을 양방향으로 허용하는지 확인해야한다

# VPC

- NAT Gateway : 프라이빗 서브넷의 인스턴스에서 인터넷 또는 다른 AWS 서비스로 트래픽을 전달한 다음 응답을 인스턴스로 다시 보낸다. NAT 게이트웨이가 생성된 후에는 인터넷 트래픽이 NAT 게이트웨이를 가리키도록 프라이빗 서브넷의 라우팅 테이블을 업데이트 해야한다.

# EC2

- #### 인스턴스에 대한 최대 절전 모드 활성화

  - 모든 프로세스를 중지하고 RAM의 내용을 EBS 루트 볼륨에 저장한 다음 정기적인 종료를 수행
  - 절전 모드를 활성화하면 인스턴스가 stopping상태가 됨
  - 인스턴스 스토어 볼룸의 데이터 손실
  - 인스턴스가 성공적으로 최대절전모드로 전환되지 않으면 정상적인 종료가 발생
  - 150GB 이상의 RAM을 사용하는 경우 최대 절전 모드 할 수 없다
  - AutoScaling 그룹에 있는 인스턴스를 최대 절전 모드로 전환할려는 경우 Auto Scaling은 인스턴스를 Stopping으로 보고 비정상으로 표시한 뒤에 종료하고 대체 인스턴스를 시작한다

- #### Elastic IP

  - 동적 클라우드 컴퓨팅을 위해 설계된 정적 IPv4 주소 이다. 
  - 인스턴스에 퍼블릭 IPv4 주소가 없는 경우 탄력적 주소를 인스턴스에 연결하여 인터넷 통신을 활성화한다

- 보안 그룹

  - 사용자의 지리적 위치를 기반으로 액세스 제한할 수 없다

- 전용 인스턴스 vs 전용 호스트

  - 전용 인스턴스는 단일 고객 전용 하드웨어의 가상 사설 클라우드(vpc)에 실행되는 인스턴스
  - 전용 호스트는 사용자 전용으로 사용되는 물리적인 서버이기도 한다. 이를 사용하면 인스턴스가 서버에 배치되는 방식을 파악하고 제어할 수 있다.

# AutoScaling

- 인스턴스에 대한 상태 확인은 EC2나 ELB에서 확인 가능하다
- 비정상이라고 판단되면 해당 인스턴스를 종료하고 새 인스턴스를 시작한다 (<-> ELB와 다름)
- 사용자가 정의한 최소 수(or 지정된 경우 원하는 수)로 실행중인 인스턴스 수를 유지해야한다

- 인스턴스가 비정상(unhealthy)인 경우
  - stopping
  - stopped
  - shutting-down
  - terminated
  - impaired
- 비정상이여도 인스턴스를 종료하지 않는 경우
  - EC2 AutoScaling은 상태 확인 유예 기간이 만료될 때까지 EC2 상태 확인 및 ELB 상태 확인을 기반으로 서비스를 시작한 인스턴스를 종료하지 않는다
  - 손상된 상태의 인스턴스는 즉시 종료하지 않고 복구 될 때까지 몇 분 기다린다
  - ELB 상태 확인에 실패한 인스턴스는 종료하지 않는다
- AutoScaling 그룹에 둘 이상의 조정 정책이 있는 경우, 확장 및 축소 모두에 가장 큰 용량을 제공하는 정책을 선택한다
- 리전별 구조로 여러 가용 영역으로 확장될 수 있지만 여러 리전으로 확장될 수 는 없다

# Global Accelerator

- 글로벌 네트워크 인프라를 통해 사용자 트래픽을 전송하여 인터넷 사용자 성능을 최대 60% 개선하는 네트워킹 서비스

- 다중 리전인 경우 사용
- 속도를 높이지는 않는다

# IAM

- IAM 데이터베이스 인증
  - 이를 통해 DB 인스턴스에 인증할 수 있다
  - MySQL 및 PostgreSQL에서 작동
  - 이 인증을 통해서 DB 인스턴스에 연결할 때 암호를 사용할 필요가 없다
- 생성한 모든 파일은 루트 사용자가 소유한다

# Lambda

- ### Lambda 모범 사례

  - #### Lambda 함수를 VPC에서 활성화해야하는 경우

    - Lambda는 항상 AWS 소유 VPC에서 작동함
    - 기본적으로 이 함수에는 퍼블릭 인터넷 주소에 대한 네트워크 요청을 수행할 수 있는 기능이 포함됨(EX. 퍼블릭 AWS API에 대한 액세스)
    - 프라이빗 서브넷에 있는 프라이빗 리소스와 상호작용 해야하는 경우에만 VPC 액세스를 위해 함수를 활성화해야한다

  - #### Lambda 계층에 공통 코드 배포

    - 둘 이상의 함수에서 코드를 재사용하는 경우 레이어를 만들어 여기에 배포를 하는 것이 좋다

  - #### 패키지 크기 및 종속성 확인

    - Lambda 함수를 사용하려면 필요한 모든 종속성을 패키징해야한다. 배포 패키지가 클수록 함수가 콜드 스타트하는 속도가 느려진다.  문서 및 사용하지 않는 라이브러리와 같은 불필요한 항목을 제거하자

  - #### 동시성 모니터링

    - Lambda 함수는 매우 빠르게 확장될 수 있으므로 동시성이 급증할 때를 알리는 제어 기능이 필요하다. 이를 위해서 함수 지표가 임계 값을 초과할 때는 팀에 알리는 Cloudwatch 경고를 배포하는 것이 좋다.

  - #### 과잉 프로비저닝된 메모리

    - 기능 시간 초과 설정을 과도하게 프로비저닝하지 않는 것이 좋다
    - 항상 코드 성능을 이해하고 그에 따라 함수 시간 제한을 설정하자
    - 오버 프로비저닝 함수 시간 초과로 인해 함수가 예상보다 오래 실행되고 예상치 못한 비용이 발생할 수 있음

  - https://aws.amazon.com/ko/blogs/architecture/best-practices-for-developing-on-aws-lambda/

- Lambda 사용의 이점

  - 서버 및 인프라 관리에 걱정할 필요가 없다

    

### Kinesis 

- 샤드를 늘리는 것은 단기적인 수정이 될 수 있지만 비용이 크게 증가한다

### 서버리스 서비스 

- API Gateway
- Lambda
- S3, Cloudfront

Serverless 아키텍처에는 프론트엔드에 API Gateway가 존재하고, 자동으로 확장되는 람다 함수를 갖게 된다

\> 고가용성과 비용 절감의 관점에서 적용되는 아키텍처 모델

\- User가 API Gateway에 request를 보낸다

\- Lambda에 resoponse를 보낸다

\- Dynamo DB나 Aurora에 작성을 한 뒤에 사용자에 대한 응답을 전송한다

# 자주 틀리는 문제 

- 대부분의 **콘텐츠가 정적**인 경우 성능을 개선하기 위해서 s3와 Cloudfront를 사용한다
- 이러한 정적 콘텐츠가 아닌 ELB, EC2 인스턴스 등이 포함되면 Global Accelator 등 다른것을 사용

- S3 Transfer Acceleration : 더 큰 객체의 장거리 전송을 위해 s3의 콘텐츠 전송 속도를 50~500%까지 높일 수 있다. (대용량 추천)
- S3 CloudFront : 짧은 지연 시간으로 지리적으로 분산된 사용자에게 정적 콘텐츠를 배포하는 강력한 방법 (1GB보다 작은 객체에  추천)

- s3 버킷 관리 
  - IAM : 직원이 많은 조직에서 단일 계정으로 여러 사용자를 생성하고 관리 가능 -> 사용자에게 버킷 또는 객체에 액새스할 수 있는 권한을 부여 , ONLY  계정 내의 사용자만 가능
  - 버킷 정책 : 단일 버킷 내의 일부 또는 모든 객체에 대한 권한을 추가하거나 거부 가능
    - 계정 또는 다른 계정 내의 사용자에게 리소스에 대한 액세스 권한을 부여함

